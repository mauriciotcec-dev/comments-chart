# Values for comments-system Helm chart
# WARNING: do NOT put GitHub Actions expressions (${{ ... }}) or secrets here.
# Inject sensitive values (image repo user, tags, mongodb.password) from CI using --set or a separate values file.

replicaCount:
  frontend: 2
  backendApi: 1
  backendData: 1

# Namespace where resources will be deployed (workflow reads this)
namespace: mauricio-tc-ec-dev

# Image repositories and tags â€” replace REPLACE_WITH_USER locally or inject via CI with --set
images:
  frontend:
    repository: "docker.io/mauriciotoapanta/frontend"
    tag: "latest"
  backendApi:
    repository: "docker.io/mauriciotoapanta/backend-api"
    tag: "latest"
  backendData:
    repository: "docker.io/mauriciotoapanta/backend-data"
    tag: "latest"

# If using private registries, the CI creates a secret named 'regcred' by default
imagePullSecrets:
  - name: regcred

# Service ports
service:
  frontend:
    port: 8080
  backendApi:
    port: 5000
  backendData:
    port: 5001
  type: ClusterIP

# MongoDB configuration
mongodb:
  image: "mongo:6.0"
  storage: "5Gi"
  user: "comments_user"
  password: "changeme"    # override from CI with --set-string mongodb.password="${{ secrets.MONGO_PASSWORD }}"
  database: "commentsdb"

# Pod resource defaults (empty map means no requests/limits)
resources: {}

# HPA configuration: global values and optional per-component overrides.
hpa:
  enabled: true
  # Global defaults (used if per-component keys are missing)
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 50

  # Optional per-component overrides (keep or remove as needed)
  frontend:
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 50
  backendApi:
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 50

# Route configuration for OpenShift
route:
  enabled: true
  # set host: "app.example.com" to pin a hostname; leave null to omit the host key (will let OpenShift assign)
  host: null
  tls:
    enabled: false
    # termination: "edge"  # ignored when tls.enabled: false

# Readiness / Liveness probe configuration per-component
# Configure backendApi readinessProbe to ensure the Service only routes traffic when the app accepts connections.
backendApi:
  readinessProbe:
    enabled: true
    # Use httpGet OR tcpSocket. If both are present, httpGet takes precedence.
    # Example httpGet:
    # httpGet:
    #   path: /health
    #   port: 5000
    # Example tcpSocket (default):
    tcpSocket:
      port: 5000
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 2
    failureThreshold: 5

# Additional notes:
# - In CI, pass image repo and tags and mongodb.password via --set, for example:
#   --set images.frontend.repository="docker.io/${{ secrets.DOCKERHUB_USERNAME }}/frontend" \
#   --set images.frontend.tag="${{ github.sha }}" \
#   --set-string mongodb.password="${{ secrets.MONGO_PASSWORD }}"